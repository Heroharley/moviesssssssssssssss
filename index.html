<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Movie/Series Embed</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: black;
        }
        #top-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
        }
        #top-bar select, #top-bar input {
            margin-left: 10px;
            padding: 5px;
        }
        #embed-container {
            flex-grow: 1;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #password-modal {
            display: none; 
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #444;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 1000;
        }
        #toggle-top-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #333;
            color: white;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        #show-top-bar {
            position: fixed;
            top: 10px;
            right: 60px;
            background-color: #333;
            color: white;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Password Modal -->
    <div id="password-modal">
        <h3 style="color: white; margin: 0 0 10px;">Enter Password</h3>
        <input type="password" id="password-input" placeholder="Password" />
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" style="color: red; margin: 5px 0 0;"></p>
    </div>

    <!-- Main Interface -->
    <div id="top-bar">
        <label for="type-select">Type:</label>
        <select id="type-select" onchange="updateInputs()">
            <option value="movie">Movie</option>
            <option value="series">Series</option>
        </select>

        <div id="inputs">
            <input type="text" id="movie-id" placeholder="IMDB/TMDB ID">
            <input type="text" id="series-id" placeholder="IMDB/TMDB ID" style="display:none;">
            <input type="number" id="season-number" placeholder="Season" style="display:none;">
            <input type="number" id="episode-number" placeholder="Episode" style="display:none;">
        </div>

        <button id="load-button" onclick="handleLoadClick()">Load</button>
        <button id="toggle-top-bar" onclick="toggleTopBar()">Hide Top Bar</button>
    </div>

    <button id="show-top-bar" onclick="toggleTopBar()">Show Top Bar</button>

    <div id="embed-container"></div>

    <script>
        const STORAGE_KEY = "passwordAuth";
        const SALT = "net"; 
        const HARDCODED_HASH = "30cc6d42be2564db1ea85126aaba391e06aeec78f99234eae8d576e2687f08ea"; 

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const saltedPassword = password + SALT;
            const data = encoder.encode(saltedPassword);
            const hashBuffer = await crypto.subtle.digest("SHA-256", data);
            return Array.from(new Uint8Array(hashBuffer))
                .map(byte => byte.toString(16).padStart(2, "0"))
                .join("");
        }

        window.onload = async () => {
            const storedHash = sessionStorage.getItem(STORAGE_KEY);
            if (storedHash !== HARDCODED_HASH) {
                sessionStorage.removeItem(STORAGE_KEY); 
                document.getElementById("password-modal").style.display = "block";
            } else {
                document.getElementById("password-modal").style.display = "none";
            }
        };

        async function checkPassword() {
            const input = document.getElementById("password-input").value;
            const errorMsg = document.getElementById("password-error");

            if (!input) {
                errorMsg.textContent = "Password cannot be empty!";
                return;
            }

            try {
                const inputHash = await hashPassword(input);
                console.log("[DEBUG] Input Hash:", inputHash); 

                if (inputHash === HARDCODED_HASH) {
                    sessionStorage.setItem(STORAGE_KEY, inputHash); 
                    document.getElementById("password-modal").style.display = "none";
                    document.getElementById("password-error").textContent = "";
                } else {
                    errorMsg.textContent = "Incorrect password!";
                    sessionStorage.removeItem(STORAGE_KEY);
                    setTimeout(() => location.reload(), 1000); 
                }
            } catch (error) {
                console.error("Hashing error:", error);
                errorMsg.textContent = "Validation error. Try reloading the page.";
            }
        }

        function handleLoadClick() {
            if (sessionStorage.getItem(STORAGE_KEY) === HARDCODED_HASH) {
                loadEmbed();
            } else {
                document.getElementById("password-modal").style.display = "block";
            }
        }

        function updateInputs() {
            const type = document.getElementById("type-select").value;
            document.getElementById("movie-id").style.display = type === "movie" ? "inline-block" : "none";
            document.getElementById("series-id").style.display = type === "series" ? "inline-block" : "none";
            document.getElementById("season-number").style.display = type === "series" ? "inline-block" : "none";
            document.getElementById("episode-number").style.display = type === "series" ? "inline-block" : "none";
        }

        function loadEmbed() {
            const type = document.getElementById("type-select").value;
            const embedContainer = document.getElementById("embed-container");

            let iframeSrc = "";

            if (type === "movie") {
                const movieId = document.getElementById("movie-id").value.trim();
                if (movieId) iframeSrc = `https://vidsrc.me/embed/movie/${movieId}`;
            } else if (type === "series") {
                const seriesId = document.getElementById("series-id").value.trim();
                const seasonNumber = document.getElementById("season-number").value.trim();
                const episodeNumber = document.getElementById("episode-number").value.trim();

                if (seriesId) {
                    iframeSrc = `https://vidsrc.me/embed/tv?imdb=${seriesId}`;
                    if (seasonNumber) iframeSrc += `&season=${seasonNumber}`;
                    if (episodeNumber) iframeSrc += `&episode=${episodeNumber}`;
                }
            }

            if (iframeSrc) {
                embedContainer.innerHTML = `<iframe src="${iframeSrc}" referrerpolicy="origin" allowfullscreen></iframe>`;
            } else {
                embedContainer.innerHTML = "";
            }
        }

        function toggleTopBar() {
            const topBar = document.getElementById("top-bar");
            const showButton = document.getElementById("show-top-bar");
            const hideButton = document.getElementById("toggle-top-bar");

            if (topBar.style.display === "none") {
                topBar.style.display = "flex";
                hideButton.textContent = "Hide Top Bar";
                showButton.style.display = "none";
            } else {
                topBar.style.display = "none";
                hideButton.textContent = "Show Top Bar";
                showButton.style.display = "block";
            }
        }
    </script>
</body>
</html>
